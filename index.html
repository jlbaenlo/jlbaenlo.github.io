<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Simple Spotify Test</title>
</head>

<body>
    <h1>Simple Auth Test</h1>
    <p>This is a minimal test to check Spotify Login.</p>

    <div id="step1">
        <button id="loginBtn">Login with Spotify</button>
        <p><strong>Current Redirect URI:</strong> <span id="uriDisplay"></span></p>
    </div>

    <div id="step2" style="display:none;">
        <h2 style="color:green;">SUCCESS! âœ…</h2>
        <p>Access Token received:</p>
        <textarea id="tokenDisplay" rows="5" cols="50"></textarea>
    </div>

    <script>
        // CONFIGURATION
        const CLIENT_ID = "1795fe450d3a4f6ebe2ce1cdcfbc21bf"; // Your ID

        // DYNAMIC REDIRECT URI (Normalizes to root if possible)
        let redirectUri = window.location.origin + window.location.pathname;
        if (redirectUri.endsWith("index.html")) {
            redirectUri = redirectUri.substring(0, redirectUri.length - "index.html".length);
        }
        // Ensure trailing slash if it's a folder root (common in GitHub Pages)
        if (!redirectUri.endsWith("/") && !redirectUri.endsWith(".html")) {
            redirectUri += "/";
        }

        document.getElementById("uriDisplay").textContent = redirectUri;

        // CHECK FOR TOKEN
        if (window.location.hash.includes("access_token")) {
            document.getElementById("step1").style.display = "none";
            document.getElementById("step2").style.display = "block";
            const params = new URLSearchParams(window.location.hash.substring(1));
            document.getElementById("tokenDisplay").value = params.get("access_token");
        }

        // LOGIN LOGIC
        document.getElementById("loginBtn").onclick = function () {
            const scope = "playlist-read-private";
            const url = "https://accounts.spotify.com/authorize" +
                "?client_id=" + CLIENT_ID +
                "&response_type=token" +
                "&redirect_uri=" + encodeURIComponent(redirectUri) +
                "&scope=" + encodeURIComponent(scope);

            console.log("Redirecting to:", url);
            window.location = url;
        };
    </script>
</body>

</html>